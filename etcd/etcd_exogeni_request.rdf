<rdf:RDF
    xmlns:ec2="http://geni-orca.renci.org/owl/ec2.owl#"
    xmlns:kansei="http://geni-orca.renci.org/owl/kansei.owl#"
    xmlns:app-color="http://geni-orca.renci.org/owl/app-color.owl#"
    xmlns:geni="http://geni-orca.renci.org/owl/geni.owl#"
    xmlns:domain="http://geni-orca.renci.org/owl/domain.owl#"
    xmlns:eucalyptus="http://geni-orca.renci.org/owl/eucalyptus.owl#"
    xmlns:collections="http://geni-orca.renci.org/owl/collections.owl#"
    xmlns:openflow="http://geni-orca.renci.org/owl/openflow.owl#"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:exogeni="http://geni-orca.renci.org/owl/exogeni.owl#"
    xmlns:request="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#"
    xmlns:layer="http://geni-orca.renci.org/owl/layer.owl#"
    xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
    xmlns:request-schema="http://geni-orca.renci.org/owl/request.owl#"
    xmlns:ip4="http://geni-orca.renci.org/owl/ip4.owl#"
    xmlns:planetlab="http://geni-orca.renci.org/owl/planetlab.owl#"
    xmlns:ethernet="http://geni-orca.renci.org/owl/ethernet.owl#"
    xmlns:dtn="http://geni-orca.renci.org/owl/dtn.owl#"
    xmlns:time="http://www.w3.org/2006/time#"
    xmlns:owl="http://www.w3.org/2002/07/owl#"
    xmlns:modify-schema="http://geni-orca.renci.org/owl/modify.owl#"
    xmlns:compute="http://geni-orca.renci.org/owl/compute.owl#"
    xmlns:topology="http://geni-orca.renci.org/owl/topology.owl#"
    xmlns:orca="http://geni-orca.renci.org/owl/orca.rdf#" > 
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#">
    <collections:element rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0"/>
    <collections:element rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#infra2"/>
    <collections:element rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#infra0"/>
    <collections:element rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#infra1"/>
    <request-schema:hasTerm rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#Term"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/request.owl#Reservation"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#TermDuration">
    <time:days rdf:datatype="http://www.w3.org/2001/XMLSchema#decimal">1</time:days>
    <rdf:type rdf:resource="http://www.w3.org/2006/time#DurationDescription"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0">
    <topology:hasInterface rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra1"/>
    <topology:hasInterface rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra0"/>
    <topology:hasInterface rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra2"/>
    <layer:atLayer rdf:resource="http://geni-orca.renci.org/owl/ethernet.owl#EthernetNetworkElement"/>
    <layer:bandwidth rdf:datatype="http://www.w3.org/2001/XMLSchema#integer">10000000</layer:bandwidth>
    <topology:hasGUID>1adbd259-461b-4edb-9ba4-0eb380579679</topology:hasGUID>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/topology.owl#BroadcastConnection"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra1">
    <ip4:localIPAddress rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra1-ip-172-16-100-2"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/topology.owl#Interface"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra1-ip-172-16-100-2">
    <ip4:netmask>255.255.255.0</ip4:netmask>
    <layer:label_ID>172.16.100.2</layer:label_ID>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/ip4.owl#IPAddress"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra0">
    <ip4:localIPAddress rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra0-ip-172-16-100-3"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/topology.owl#Interface"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#infra2">
    <topology:hasInterface rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra2"/>
    <topology:hasGUID>34c1cfc9-2235-4b03-8013-3248c9415fd2</topology:hasGUID>
    <request-schema:postBootScript rdf:datatype="http://www.w3.org/2001/XMLSchema#string">#!/bin/bash

echo $infra0.IP("VLAN0") infra0 &gt;&gt; /etc/hosts
echo $infra1.IP("VLAN0") infra1 &gt;&gt; /etc/hosts
echo $infra2.IP("VLAN0") infra2 &gt;&gt; /etc/hosts

echo `echo $self.Name() | sed 's/\//-/g'` &gt; /etc/hostname
/bin/hostname -F /etc/hostname

# Install docker
yum makecache fast
yum -y update
yum install -y yum-utils git
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
yum makecache fast
yum install -y docker-ce
systemctl start docker
systemctl enable docker


# https://github.com/coreos/etcd/blob/master/Documentation/op-guide/container.md#docker
ETCD_VERSION=latest
TOKEN=exogeni-etc-cluster
CLUSTER_STATE=new
NAME_1=infra0
NAME_2=infra1
NAME_3=infra2
HOST_1=$infra0.IP("VLAN0")
HOST_2=$infra1.IP("VLAN0")
HOST_3=$infra2.IP("VLAN0")
CLUSTER=${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380
DATA_DIR=/var/lib/etcd

if [[ $self.Name() == infra0 ]]
then
  THIS_NAME=${NAME_1}
  THIS_IP=${HOST_1}
elif [[ $self.Name() == infra1 ]]
then
  THIS_NAME=${NAME_2}
  THIS_IP=${HOST_2}
elif [[ $self.Name() == infra2 ]]
then
  THIS_NAME=${NAME_3}
  THIS_IP=${HOST_3}
fi

docker run \
  -p 2379:2379 \
  -p 2380:2380 \
  --volume=${DATA_DIR}:/etcd-data \
  --name etcd quay.io/coreos/etcd:${ETCD_VERSION} \
  /usr/local/bin/etcd \
  --data-dir=/etcd-data --name ${THIS_NAME} \
  --initial-advertise-peer-urls http://${THIS_IP}:2380 --listen-peer-urls http://0.0.0.0:2380 \
  --advertise-client-urls http://${THIS_IP}:2379 --listen-client-urls http://0.0.0.0:2379 \
  --initial-cluster ${CLUSTER} \
  --initial-cluster-state ${CLUSTER_STATE} --initial-cluster-token ${TOKEN}</request-schema:postBootScript>
    <request-schema:inDomain rdf:resource="http://geni-orca.renci.org/owl/rcivmsite.rdf#rcivmsite/Domain"/>
    <compute:diskImage rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#Centos+7.3+v1.0.2"/>
    <compute:specificCE rdf:resource="http://geni-orca.renci.org/owl/exogeni.owl#XOSmall"/>
    <domain:hasResourceType rdf:resource="http://geni-orca.renci.org/owl/compute.owl#VM"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/compute.owl#ComputeElement"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#infra1">
    <topology:hasInterface rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra1"/>
    <topology:hasGUID>9ad933a9-d716-4c76-9c31-2825c002775b</topology:hasGUID>
    <request-schema:postBootScript rdf:datatype="http://www.w3.org/2001/XMLSchema#string">#!/bin/bash

echo $infra0.IP("VLAN0") infra0 &gt;&gt; /etc/hosts
echo $infra1.IP("VLAN0") infra1 &gt;&gt; /etc/hosts
echo $infra2.IP("VLAN0") infra2 &gt;&gt; /etc/hosts

echo `echo $self.Name() | sed 's/\//-/g'` &gt; /etc/hostname
/bin/hostname -F /etc/hostname

# Install docker
yum makecache fast
yum -y update
yum install -y yum-utils git
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
yum makecache fast
yum install -y docker-ce
systemctl start docker
systemctl enable docker


# https://github.com/coreos/etcd/blob/master/Documentation/op-guide/container.md#docker
ETCD_VERSION=latest
TOKEN=exogeni-etc-cluster
CLUSTER_STATE=new
NAME_1=infra0
NAME_2=infra1
NAME_3=infra2
HOST_1=$infra0.IP("VLAN0")
HOST_2=$infra1.IP("VLAN0")
HOST_3=$infra2.IP("VLAN0")
CLUSTER=${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380
DATA_DIR=/var/lib/etcd

if [[ $self.Name() == infra0 ]]
then
  THIS_NAME=${NAME_1}
  THIS_IP=${HOST_1}
elif [[ $self.Name() == infra1 ]]
then
  THIS_NAME=${NAME_2}
  THIS_IP=${HOST_2}
elif [[ $self.Name() == infra2 ]]
then
  THIS_NAME=${NAME_3}
  THIS_IP=${HOST_3}
fi

docker run \
  -p 2379:2379 \
  -p 2380:2380 \
  --volume=${DATA_DIR}:/etcd-data \
  --name etcd quay.io/coreos/etcd:${ETCD_VERSION} \
  /usr/local/bin/etcd \
  --data-dir=/etcd-data --name ${THIS_NAME} \
  --initial-advertise-peer-urls http://${THIS_IP}:2380 --listen-peer-urls http://0.0.0.0:2380 \
  --advertise-client-urls http://${THIS_IP}:2379 --listen-client-urls http://0.0.0.0:2379 \
  --initial-cluster ${CLUSTER} \
  --initial-cluster-state ${CLUSTER_STATE} --initial-cluster-token ${TOKEN}</request-schema:postBootScript>
    <request-schema:inDomain rdf:resource="http://geni-orca.renci.org/owl/rcivmsite.rdf#rcivmsite/Domain"/>
    <compute:diskImage rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#Centos+7.3+v1.0.2"/>
    <compute:specificCE rdf:resource="http://geni-orca.renci.org/owl/exogeni.owl#XOSmall"/>
    <domain:hasResourceType rdf:resource="http://geni-orca.renci.org/owl/compute.owl#VM"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/compute.owl#ComputeElement"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra2">
    <ip4:localIPAddress rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra2-ip-172-16-100-1"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/topology.owl#Interface"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#infra0">
    <topology:hasInterface rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra0"/>
    <topology:hasGUID>5bb20a8b-d434-4420-b8de-fa99bc72ac9d</topology:hasGUID>
    <request-schema:postBootScript rdf:datatype="http://www.w3.org/2001/XMLSchema#string">#!/bin/bash

echo $infra0.IP("VLAN0") infra0 &gt;&gt; /etc/hosts
echo $infra1.IP("VLAN0") infra1 &gt;&gt; /etc/hosts
echo $infra2.IP("VLAN0") infra2 &gt;&gt; /etc/hosts

echo `echo $self.Name() | sed 's/\//-/g'` &gt; /etc/hostname
/bin/hostname -F /etc/hostname

# Install docker
yum makecache fast
yum -y update
yum install -y yum-utils git
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
yum makecache fast
yum install -y docker-ce
systemctl start docker
systemctl enable docker


# https://github.com/coreos/etcd/blob/master/Documentation/op-guide/container.md#docker
ETCD_VERSION=latest
TOKEN=exogeni-etc-cluster
CLUSTER_STATE=new
NAME_1=infra0
NAME_2=infra1
NAME_3=infra2
HOST_1=$infra0.IP("VLAN0")
HOST_2=$infra1.IP("VLAN0")
HOST_3=$infra2.IP("VLAN0")
CLUSTER=${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380
DATA_DIR=/var/lib/etcd

if [[ $self.Name() == infra0 ]]
then
  THIS_NAME=${NAME_1}
  THIS_IP=${HOST_1}
elif [[ $self.Name() == infra1 ]]
then
  THIS_NAME=${NAME_2}
  THIS_IP=${HOST_2}
elif [[ $self.Name() == infra2 ]]
then
  THIS_NAME=${NAME_3}
  THIS_IP=${HOST_3}
fi

docker run \
  -p 2379:2379 \
  -p 2380:2380 \
  --volume=${DATA_DIR}:/etcd-data \
  --name etcd quay.io/coreos/etcd:${ETCD_VERSION} \
  /usr/local/bin/etcd \
  --data-dir=/etcd-data --name ${THIS_NAME} \
  --initial-advertise-peer-urls http://${THIS_IP}:2380 --listen-peer-urls http://0.0.0.0:2380 \
  --advertise-client-urls http://${THIS_IP}:2379 --listen-client-urls http://0.0.0.0:2379 \
  --initial-cluster ${CLUSTER} \
  --initial-cluster-state ${CLUSTER_STATE} --initial-cluster-token ${TOKEN}</request-schema:postBootScript>
    <request-schema:inDomain rdf:resource="http://geni-orca.renci.org/owl/rcivmsite.rdf#rcivmsite/Domain"/>
    <compute:diskImage rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#Centos+7.3+v1.0.2"/>
    <compute:specificCE rdf:resource="http://geni-orca.renci.org/owl/exogeni.owl#XOSmall"/>
    <domain:hasResourceType rdf:resource="http://geni-orca.renci.org/owl/compute.owl#VM"/>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/compute.owl#ComputeElement"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#Term">
    <time:hasDurationDescription rdf:resource="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#TermDuration"/>
    <rdf:type rdf:resource="http://www.w3.org/2006/time#Interval"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra2-ip-172-16-100-1">
    <ip4:netmask>255.255.255.0</ip4:netmask>
    <layer:label_ID>172.16.100.1</layer:label_ID>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/ip4.owl#IPAddress"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#VLAN0-infra0-ip-172-16-100-3">
    <ip4:netmask>255.255.255.0</ip4:netmask>
    <layer:label_ID>172.16.100.3</layer:label_ID>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/ip4.owl#IPAddress"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/3b270a7c-9f55-48ed-a95b-3d02b093644c#Centos+7.3+v1.0.2">
    <topology:hasName rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Centos 7.3 v1.0.2</topology:hasName>
    <topology:hasURL>http://geni-images.renci.org/images/standard/centos/centos7.3-v1.0.2/centos7.3-v1.0.2.xml</topology:hasURL>
    <topology:hasGUID>a975e8ba8ace7358c5589f379675ce89c8830053</topology:hasGUID>
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/compute.owl#DiskImage"/>
  </rdf:Description>
  <rdf:Description rdf:about="http://geni-orca.renci.org/owl/rcivmsite.rdf#rcivmsite/Domain">
    <rdf:type rdf:resource="http://geni-orca.renci.org/owl/topology.owl#NetworkDomain"/>
  </rdf:Description>
</rdf:RDF>
